<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ResBoardMapper">
    <!-- Board List -->
    <select id="boardList" resultType="ResBoardDTO">
        SELECT *
        FROM m_resboard
        WHERE r_uid NOT IN (
            SELECT b_uid_1
            FROM m_block
            WHERE b_uid_2 = #{u_id }

            UNION DISTINCT

            SELECT b_uid_2
            FROM m_block
            WHERE b_uid_1 = #{u_id }
        )
        <include refid="sort" />
    </select>
    <sql id="sort">
        <!-- 최신순 정렬 -->
        <if test="_parameter == null">
            ORDER BY r_id DESC;
        </if>
        <if test="_parameter == 'r_id'">
            ORDER BY r_id DESC;
        </if>

        <!-- 조회수 정렬 -->
        <if test="_parameter == 'r_view'">
            ORDER BY r_view ASC;
        </if>
    </sql>

    <!-- SELECT Board -->
    <select id="boardSelect" resultType="ResBoardDTO">
        SELECT *
        FROM m_resboard
        WHERE r_id = #{r_id };
    </select>

    <select id="boardSelectToUid" resultType="ResBoardDTO">
        select *
        from m_resboard
        where r_uid = #{u_id};
    </select>

    <select id="boardSelectToRname" resultType="ResBoardDTO">
        select *
        from m_resboard
        where r_name = #{r_name};
    </select>

    <!-- INSERT Board -->
    <insert id="boardInsert">
        INSERT INTO m_resboard(r_uid, r_sub, r_name, r_address, r_contents, r_rating)
        VALUES (#{r_uid }, #{r_sub }, #{r_name }, #{r_address }, #{r_contents }, #{r_rating });
    </insert>

    <!-- Delete Board -->
    <delete id="boardDelete">
        DELETE FROM m_resboard
        WHERE r_id = #{r_id };
    </delete>

    <!-- Update Board -->
    <update id="boardUpdate">
        UPDATE m_resboard
        SET r_sub = #{r_sub }, r_name = #{r_name }, r_address = #{r_address }, r_contents = #{r_contents }, r_rating = #{r_rating }
        WHERE r_id = #{r_id };
    </update>

    <!-- Update r_view -->
    <update id="updateR_view">
        UPDATE m_resboard
        SET r_view = r_view + 1
        WHERE r_id = #{r_id };
    </update>
</mapper>